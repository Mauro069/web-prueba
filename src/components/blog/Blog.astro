---
import { getLocaleFromUrl, createTranslator } from '../../i18n/utils.js';
import { TRANSLATION_KEYS, PAGES, DEFAULT_LOCALE, type Locale } from '../../constants/index.js';
import { getAllPosts } from '../../data/blog';

const currentLocale = getLocaleFromUrl(Astro.url) as Locale;
const t = createTranslator(currentLocale);
const posts = getAllPosts(currentLocale);

// Generar URLs para posts según el idioma
const getBlogPostUrl = (slug: string) => {
  if (currentLocale === DEFAULT_LOCALE) {
    return `/blog/${slug}`;
  } else {
    return `/${currentLocale}/blog/${slug}`;
  }
};

// Formatear fecha según el idioma
const formatDate = (dateString: string) => {
  const date = new Date(dateString);
  const localeMap = {
    'es': 'es-ES',
    'en': 'en-US', 
    'fr': 'fr-FR',
    'pt': 'pt-BR'
  };
  
  return date.toLocaleDateString(localeMap[currentLocale] || 'es-ES', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};
---

<div class="max-w-4xl mx-auto">
  <!-- Header del Blog -->
  <div class="text-center mb-12">
    <h1 class="text-4xl font-bold text-gray-900 mb-4">
      {t(TRANSLATION_KEYS.BLOG_TITLE)}
    </h1>
    <p class="text-xl text-gray-600 max-w-2xl mx-auto">
      {t(TRANSLATION_KEYS.BLOG_DESCRIPTION)}
    </p>
  </div>

  <!-- Lista de Posts -->
  <div class="space-y-8">
    {posts.map((post) => (
      <article class="bg-main-blue-50 rounded-lg shadow-sm border p-6 hover:shadow-md transition-shadow duration-200">
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-4">
          <h2 class="text-2xl font-semibold text-gray-900 mb-2 md:mb-0">
            <a 
              href={getBlogPostUrl(post.slug)}
              class="hover:text-blue-600 transition-colors duration-200"
            >
              {post.title}
            </a>
          </h2>
          <div class="flex items-center text-sm text-gray-500 space-x-4">
            <span>{formatDate(post.publishedDate)}</span>
            <span>•</span>
            <span>{post.readingTime} min</span>
          </div>
        </div>
        
        <p class="text-gray-600 mb-4 leading-relaxed">
          {post.excerpt}
        </p>
        
        <div class="flex items-center justify-between">
          <div class="flex flex-wrap gap-2">
            {post.tags.map((tag) => (
              <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
                {tag}
              </span>
            ))}
          </div>
          
          <a 
            href={getBlogPostUrl(post.slug)}
            class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium transition-colors duration-200"
          >
            {t(TRANSLATION_KEYS.BLOG_READ_MORE)}
            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </a>
        </div>
        
        <div class="mt-4 pt-4 border-t border-gray-100">
          <p class="text-sm text-gray-500">
            Por {post.author}
          </p>
        </div>
      </article>
    ))}
  </div>

  <!-- Mensaje si no hay posts -->
  {posts.length === 0 && (
    <div class="text-center py-12">
      <p class="text-gray-500 text-lg">No hay posts disponibles en este momento.</p>
    </div>
  )}
</div> 